{% extends "./layout/layout.html" %}

{% block head %}
<link rel="stylesheet" type="text/css" href="/public/css/page-sj-person-homepage.css" />
{% endblock %}

{% block main %}
<div class="myhome-personinfo" style="background-color:#AEDD81">
  <div class="wrapper">
    <div class="person-baseinfo">
      <!--头像信息-->
      <div class="photo">
        <img src="/public/img/widget-myphoto.jpg" alt="" class="person" />
        <div class="share">
          <span><img src="/public/img/asset-QQ.png" alt="" width="34" height="28" /></span>
          <span><img src="/public/img/asset-weixin.png" alt="" width="28" height="28" /></span>
          <span><img src="/public/img/asset-weibo.png" alt="" width="28" height="28" /></span>
        </div>
      </div>
      <!--文字信息-->
      <div class="info">
        <h1>Web爱好者<span class="allinfo"><a href="./settings-profile.html" target="_blank">编辑个人资料</a></span></h1>
        <ul class="fill">
          <li> <i class="fa fa-map-marker" aria-hidden="true"></i> <span class="edit-item"> 填写现居城市</span>
            <form action="" class="sui-form form-inline">
              <input type="text" placeholder="现居城市" />
              <button class="sui-btn btn-danger save-btn">保存</button>
            </form>
          </li>
          <li> <i class="fa fa-graduation-cap" aria-hidden="true"></i> <span class="edit-item"> 填写毕业院校</span>
            <form action="" class="sui-form form-inline">
              <input type="text" placeholder="院校名称" />
              <input type="text" placeholder="所学专业" />
              <button class="sui-btn btn-danger save-btn">保存</button>
            </form>
          </li>
          <li> <i class="fa fa-shopping-bag" aria-hidden="true"></i> <span class="edit-item"> 填写所在公司/组织</span>
            <form action="" class="sui-form form-inline">
              <input type="text" placeholder="公司/组织名称" />
              <input type="text" placeholder="职位头衔" />
              <button class="sui-btn btn-danger save-btn">保存</button>
            </form>
          </li>
          <li> <i class="fa fa-link" aria-hidden="true"></i> <span class="edit-item"> 填写个人网站</span>
            <form action="" class="sui-form form-inline">
              <input type="text" placeholder="个人网站" />
              <button class="sui-btn btn-danger save-btn">保存</button>
            </form>
          </li>
        </ul>
      </div>
    </div>
    <!--右侧编辑-->
    <div class="edit-info">
      <h4>个人简介<span class="addedit"><img src="/public/img/widget-edit.png" width="12" height="12" />编辑</span></h4>
      <div class="info-box">
        <div class="edit-intro">
          暂时没有个人简介
        </div>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
</div>
<!--两列布局-->
<div class="wrapper  myhome">
  <div class="right-content">
    <div class="home-content">
      <ul class="sui-nav nav-tabs nav-large" id="nav-tabs">
        <li class="active"><a href="/home/{{ user._id }}/posts" data-toggle="one" data-tpl="posts">动态</a></li>
        <li><a href="/home/{{ user._id }}/comments" data-toggle="two" data-tpl="comments">回答</a></li>
        <li><a href="/home/{{ user._id }}/tags" data-toggle="three" data-tpl="tags">标签</a></li>
      </ul>
      <div class="tab-content tab-wraped">
        <div id="one" class="tab-pane active">
          <ul class="question-list" id="posts">
            <!-- 待填坑 -->
          </ul>
        </div>
        <div id="two" class="tab-pane">
          <ul class="question-list" id="comments">
            <!-- 待填坑 -->
          </ul>
        </div>
        <div id="three" class="tab-pane">
          <ul class="question-list" id="tags">
            <!-- 待填坑 -->
          </ul>
        </div>
      </div>
      <div class="activities">
        <h4 class="tit"><span>我的动态</span></h4>
        <ul class="activities-content">
          <li>
            <div class="index-title">
              <span class="author">本杰明</span>
              <span class="operate">关注了标签</span> &middot;
              <span class="time">3小时前</span>
            </div>
            <div class="guanzhuname">
              <span class="tag">php</span>
              <span class="tagnum">100</span> 关注
            </div>
            <div class="intro">
              PHP，是英文超文本预处理语言 Hypertext Preprocessor 的缩写。PHP 是一种开源的通用计算机脚本语言，尤其适用于网络开发并可嵌入HTML中使用。PHP
              的语法借鉴吸收C语言、Java和Perl等流行计算机语言的特点，易于一般程序员学习。
            </div>
          </li>
          <li>
            <div class="index-title">
              <span class="author">本杰明</span>
              <span class="operate">回答了问题</span> &middot;
              <span class="time">3小时前</span>
            </div>
            <div class="question">
              <p class="title">网页链接如何直接打开微信，并进入公众号关注页面</p>
              <p class="content">现在针对这个微信是屏蔽的，你可以选择通过连接到一个其他的公众号文章中进行关注。</p>
            </div>
            <div class="qa-num">
              <span>关注<i>1</i></span>
              <span>回答<i>2</i></span>
            </div>
          </li>
          <li>
            <div class="index-title">
              <span class="author">本杰明</span>
              <span class="operate">收藏了文章</span> &middot;
              <span class="time">3小时前</span>
            </div>
            <div class="question">
              <p class="title">网页链接如何直接打开微信，并进入公众号关注页面</p>
            </div>
            <div class="qa-num">
              <span><a href="#">http://baidu.com</a></span>
            </div>
          </li>
          <li>
            <div class="index-title">
              <span class="author">本杰明</span>
              <span class="operate">收藏了文章</span> &middot;
              <span class="time">3小时前</span>
            </div>
            <div class="question">
              <p class="title">网页链接如何直接打开微信，并进入公众号关注页面</p>
            </div>
            <div class="qa-num">
              <span><a href="#">http://baidu.com</a></span>
            </div>
          </li>
          <li>
            <div class="index-title">
              <span class="author">本杰明</span>
              <span class="operate">回答了问题</span> &middot;
              <span class="time">3小时前</span>
            </div>
            <div class="question">
              <p class="title">网页链接如何直接打开微信，并进入公众号关注页面</p>
              <p class="content">现在针对这个微信是屏蔽的，你可以选择通过连接到一个其他的公众号文章中进行关注。</p>
            </div>
            <div class="qa-num">
              <span>关注<i>1</i></span>
              <span>回答<i>2</i></span>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="clearfix"></div>
</div>
{% endblock %}

{% block script %}
<script src="/node_modules/dayjs/dayjs.min.js"></script>
<script src="/node_modules/dayjs/plugin/relativeTime.js"></script>
<script src="/node_modules/dayjs/locale/zh-cn.js"></script>
<!-- 发布的主题模板 -->
<script type="text/template" id="tpl-posts">
  <% data.forEach(topic => { %>
    <li> 
      <span class="fl good">
        <span class="num"><%= topic.voteCount %></span> 
        有用
      </span>
      <span class="title">
        <a href="#"><%= topic.title %></a>
      </span> 
      <span class="fr date"><%= topic.updatedAt %></span> 
      <span class="clearfix"></span>
    </li>
  <% }) %>
</script>

<!-- 发布的评论模板 -->
<script type="text/template" id="tpl-comments">
  <% data.forEach(comment => { %>
    <li> 
      <span class="fl good">
        <span class="num"><%= comment.voteCount %></span> 
        有用
      </span>
      <span class="title">
        <a href="#"><%= comment.title %></a>
      </span> 
      <span class="fr date"><%= comment.updatedAt %></span> 
      <span class="clearfix"></span>
    </li>
  <% }) %>
</script>

<!-- 关注的标签 -->
<script type="text/template" id="tpl-tags">
  <% if (data.length) { %>
  <% data.forEach(tag => { %>
    <li> 
      <span class="fl good">
        <span class="num"><%= tag.voteCount %></span> 
        有用
      </span>
      <span class="title">
        <a href="#"><%= tag.title %></a>
      </span> 
      <span class="fr date"><%= tag.updatedAt %></span> 
      <span class="clearfix"></span>
    </li>
  <% }) %>
  <% } else { %>
    <li>
      <span>没有数据</span>
    </li>
  <% } %> 
</script>

<script>
  // 加载中文包
  dayjs.locale('zh-cn')

  // 加载相对时间模块
  dayjs.extend(dayjs_plugin_relativeTime)

  $(function () {

    const user = JSON.parse(window.localStorage.getItem('userInfo'))

    // console.log(user)

    $.ajax({
      url: `/home/${user.userId}/posts`,
      method: 'GET',
      success(res) {
        // console.log(res)
        if (res.code === 0) {
          let {
            data
          } = res
          // console.log(topics)
          handleRes(data.slice(0, 5), 'posts')
        }
      }
    })

    $('#nav-tabs li a').on('click', function () {
      // console.log($(this).attr('href'))
      const {
        toggle,
        tpl
      } = $(this).data()
      // 变换tab
      $(this).closest('#nav-tabs').find('li').removeClass('active')
      $(this).parent().addClass('active')
      // 变换内容
      $('.tab-content').children('div').hide()
      $(`#${toggle}`).show()
      // 发送请求
      $.ajax({
        url: $(this).attr('href'),
        method: 'GET',
        success: res => {
          // console.log(res)
          if (res.code === 0) {
            let {
              data
            } = res
            console.log(data)
            handleRes(data.slice(0, 5), tpl)
          }
        }
      })

      return false
    })

    function handleRes(data, tplType) {
      // 修改时间
      if (data.length) {
        data.forEach(v => {
          v.updatedAt = dayjs().from(dayjs(v.updatedAt))
          v.createdAt = dayjs().from(dayjs(v.createdAt))
        })
      }
      let tplHtml = $(`#tpl-${tplType}`).html()
      // console.log(tplHtml)
      let htmlStr = _.template(tplHtml)({
        data
      })
      $(`#${tplType}`).html(htmlStr)
    }

  })
</script>
{% endblock %}